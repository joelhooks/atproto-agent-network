{
  "name": "atproto-agent-network",
  "description": "Decentralized agent communication and memory network on Cloudflare",
  "version": "0.0.1",
  "stories": [
    {
      "id": "setup-vitest",
      "title": "Setup Vitest with coverage",
      "description": "Configure Vitest for unit testing across all packages",
      "issue": 14,
      "priority": 1,
      "validationCommand": "bun test packages/core",
      "acceptanceCriteria": [
        "bun test runs and passes",
        "Coverage report in coverage/",
        "Sample test for identity passes"
      ]
    },
    {
      "id": "test-utilities",
      "title": "Create test utilities and fixtures",
      "description": "Shared test utilities for consistent testing",
      "issue": 15,
      "priority": 2,
      "validationCommand": "bun test packages/core/src/test-utils",
      "acceptanceCriteria": [
        "createTestIdentity() generates valid keypairs",
        "createTestRecord() creates encrypted records",
        "All fixtures have tests"
      ],
      "dependsOn": ["setup-vitest"]
    },
    {
      "id": "ci-workflow",
      "title": "Add CI workflow (GitHub Actions)",
      "description": "CI that blocks merges on test failure",
      "issue": 18,
      "priority": 3,
      "validationCommand": "cat .github/workflows/ci.yml",
      "acceptanceCriteria": [
        "CI runs on push and PR",
        "Workflow file exists and is valid YAML"
      ]
    },
    {
      "id": "x25519-keys",
      "title": "Implement X25519 key generation",
      "description": "X25519 keypair generation and export",
      "issue": 7,
      "priority": 4,
      "validationCommand": "bun test packages/core/src/crypto.test.ts",
      "acceptanceCriteria": [
        "generateX25519Keypair works",
        "generateEd25519Keypair works",
        "exportPublicKey returns multibase",
        "deriveSharedSecret works"
      ],
      "dependsOn": ["setup-vitest"]
    },
    {
      "id": "envelope-encryption",
      "title": "Implement envelope encryption",
      "description": "DEK per record, encrypted with agent public key",
      "issue": 8,
      "priority": 5,
      "validationCommand": "bun test packages/core/src/crypto.test.ts",
      "acceptanceCriteria": [
        "encryptRecord returns encrypted data",
        "decryptRecord recovers plaintext",
        "No plaintext in encrypted output",
        "Different nonce each call"
      ],
      "dependsOn": ["x25519-keys"]
    },
    {
      "id": "d1-schema",
      "title": "Create D1 schema for encrypted records",
      "description": "D1 schema with encrypted columns",
      "issue": 9,
      "priority": 6,
      "validationCommand": "cat apps/network/schema.sql",
      "acceptanceCriteria": [
        "Schema includes all columns",
        "All ciphertext columns are BLOB",
        "Proper indexes"
      ]
    },
    {
      "id": "pi-agent-wrapper",
      "title": "Implement Pi agent wrapper",
      "description": "Wrap Pi runtime for Durable Objects",
      "issue": 10,
      "priority": 7,
      "validationCommand": "bun test packages/agent",
      "acceptanceCriteria": [
        "Can create agent instance",
        "Can prompt and get response",
        "Remember/recall tools exist"
      ],
      "dependsOn": ["envelope-encryption"]
    },
    {
      "id": "encrypted-memory",
      "title": "Implement EncryptedMemory class",
      "description": "Store and retrieve encrypted records",
      "issue": 11,
      "priority": 8,
      "validationCommand": "bun test packages/agent/src/memory.test.ts",
      "acceptanceCriteria": [
        "store() encrypts content",
        "retrieve() decrypts content",
        "list() returns metadata only",
        "No plaintext in D1"
      ],
      "dependsOn": ["envelope-encryption", "d1-schema"]
    }
  ],
  "sprints": [
    {
      "id": "sprint-0",
      "name": "Foundation",
      "goal": "Testing infrastructure and CI",
      "stories": ["setup-vitest", "test-utilities", "ci-workflow"],
      "hitlGate": null
    },
    {
      "id": "sprint-1",
      "name": "Crypto Core",
      "goal": "X25519 keys and envelope encryption",
      "stories": ["x25519-keys", "envelope-encryption"],
      "hitlGate": "Security review: verify crypto implementation"
    },
    {
      "id": "sprint-2",
      "name": "Storage Layer",
      "goal": "D1 schema and encrypted memory",
      "stories": ["d1-schema", "pi-agent-wrapper", "encrypted-memory"],
      "hitlGate": "Security gate: verify no plaintext in D1"
    }
  ],
  "loopConfig": {
    "maxIterations": 10,
    "validationTimeout": 120,
    "autoCommit": true,
    "branchPrefix": "feat/",
    "retrospective": {
      "enabled": true,
      "afterStories": 3,
      "template": "#20"
    },
    "gardening": {
      "updateEpicCheckboxes": true,
      "linkPRsToIssues": true,
      "updateBlockedIssues": true
    }
  }
}
