name = "agent-network"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[vars]
# Cloudflare AI Gateway slug (Dashboard -> AI -> AI Gateway)
AI_GATEWAY_SLUG = "atproto-agent-network"
# Default OpenRouter reasoning model
OPENROUTER_MODEL_DEFAULT = "moonshot/kimi-k2"

# Durable Objects
[[durable_objects.bindings]]
name = "AGENTS"
class_name = "AgentDO"

[[durable_objects.bindings]]
name = "RELAY"
class_name = "RelayDO"

# Database
[[d1_databases]]
binding = "DB"
database_name = "agent-records"
database_id = "REPLACE_WITH_D1_ID"

# Blob storage
[[r2_buckets]]
binding = "BLOBS"
bucket_name = "agent-blobs"

# Vector search
[[vectorize]]
binding = "VECTORIZE"
index_name = "agent-memory"

# Message queue
[[queues.producers]]
queue = "agent-messages"
binding = "MESSAGE_QUEUE"

[[queues.consumers]]
queue = "agent-messages"
max_batch_size = 10
max_batch_timeout = 30

# AI
[ai]
binding = "AI"

# Migrations
[[migrations]]
tag = "v1"
new_classes = ["AgentDO", "RelayDO"]

[env.production]
name = "agent-network"

[env.production.vars]
AI_GATEWAY_SLUG = "atproto-agent-network"
OPENROUTER_MODEL_DEFAULT = "moonshot/kimi-k2"

[env.staging]
name = "agent-network-staging"

[env.staging.vars]
AI_GATEWAY_SLUG = "atproto-agent-network"
OPENROUTER_MODEL_DEFAULT = "moonshot/kimi-k2"
