name = "agent-network"
main = "src/index.ts"
# Needed for Node.js builtin module resolution under nodejs_compat.
# See Wrangler error: "Could not resolve 'http' ... update your compatibility_date to 2024-09-23 or later."
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[vars]
AI_GATEWAY_SLUG = "atproto-agent-network"
OPENROUTER_MODEL_DEFAULT = "google/gemini-2.0-flash-001"
EMBEDDING_MODEL = "@cf/baai/bge-large-en-v1.5"
VECTORIZE_DIMENSIONS = "1024"

# Durable Objects
[[durable_objects.bindings]]
name = "AGENTS"
class_name = "AgentDO"

[[durable_objects.bindings]]
name = "RELAY"
class_name = "RelayDO"

# Database
[[d1_databases]]
binding = "DB"
database_name = "agent-records"
database_id = "98bf7535-be31-42cb-a4fa-0767d294b5f1"

# Migrations (Durable Objects)
[[migrations]]
tag = "v1"
new_classes = ["AgentDO", "RelayDO"]

[[r2_buckets]]
binding = "BLOBS"
bucket_name = "agent-blobs"

[[vectorize]]
binding = "VECTORIZE"
index_name = "agent-memory"

[[queues.producers]]
queue = "agent-messages"
binding = "MESSAGE_QUEUE"

[ai]
binding = "AI"

[observability]
enabled = true

[observability.logs]
enabled = true
invocation_logs = true

[observability.traces]
enabled = true



# O11Y: events flow through CF Pipelines â†’ R2 Data Catalog (Iceberg)
[[pipelines]]
binding = "O11Y_PIPELINE"
pipeline = "6a7c771ecbc7428bb9b3c5b7aeb8167e"
